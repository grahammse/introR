---
title: "Module 7:  Dataframes and Tibbles"
subtitle:  "A New Take on a Classic"
author: "Graham Eglit"
institute: "Axsome Therapeutics"
date: "Fall 2024"
output:
  xaringan::moon_reader:
    css: 
      - xaringan-themer.css
      - extra.css
    lib_dir: libs
    seal: false
    self_contained: true
    nature:
      highlightStyle: github
      highlightLines: true
      ratio: 16:9
---

```{r xaringan-themer, include=FALSE, warning=FALSE}
require(xaringanthemer)
require(xaringanExtra)
require(icons)
require(palmerpenguins)
require(tidyverse)
style_duo(primary_color = "#e3e3e2", 
          secondary_color = "#8a2377",
          code_inline_color = "#7f6a8f",
          text_font_size = "1.1rem",
          header_font_google = google_font("Lato"),
          text_font_google   = google_font("Lora"),
          code_font_google   = google_font("Space Mono")
          )
```

```{r xaringan-panelset, echo=FALSE}
xaringanExtra::use_panelset()
xaringanExtra::use_tile_view()
xaringanExtra::use_clipboard()
xaringanExtra::use_scribble()
xaringanExtra::use_search(show_icon = FALSE)
xaringanExtra::use_extra_styles(
  hover_code_line = TRUE,         #<<
  mute_unhighlighted_code = TRUE  #<<
)
```

class: title-slide, right, top
background-image: url(img/hex_tibble.png), url(img/axsome_logo.png)
background-position: 93% 75%, 50% 50%
background-size: 10%, 40%

```{r xaringan-logo, echo=FALSE}
xaringanExtra::use_logo(
  image_url = "img/axsome_logo.png",
  position = xaringanExtra::css_position(top = ".5em", right = ".5em"),
  height = "130px",
  width = "150px",
  exclude_class = c("title-slide", "inverse", "hide_logo")
)
```


.right-column[
# `r rmarkdown::metadata$title`
### `r rmarkdown::metadata$subtitle`

**`r rmarkdown::metadata$author`**<br>
`r rmarkdown::metadata$institute`<br>
`r rmarkdown::metadata$date`
]



---
class: inverse center middle

# data.frame
----
`r icons::icon_style(icons::fontawesome("r-project"), scale = 3, fill = "white")`




---

.center[
# data.frames
]

.panelset[

.panel[.panel-name[Overview]

.pull-left[
- Most common data object for analysis and visualization
- List type object
- Composed of vectors of a single type as columns
- Different columns can be of different type
   - Sepal.Length is numeric
   - Species is factor
- All rows must be of same length
- data.frame is a base R object class
]


.pull-right[
```{r echo = FALSE}
require(tidyverse)
iris %>% 
  select(Sepal.Length, Sepal.Width, Species) %>% 
  head(10)
```

]

]<!---->


.panel[.panel-name[Creating data.frames]

.pull-left[
- the `data.frame()` function can be used to create a data.frame <br> <br>
- specify the data as arguments within the `data.frame()` function <br> <br>
- can also convert other objects to a data frame using the `as.data.frame()` function
]

.pull-right[

```{r eval = FALSE}
data.frame(
  var1 = c(1, 2, 3),
  var2 = c(4, 5, 6)
)
```

```{r echo = FALSE}
data.frame(
  var1 = c(1, 2, 3),
  var2 = c(4, 5, 6)
) %>% 
  knitr::kable("html")
```

]
]<!---->

]<!--end panelset-->




---
class: inverse center middle

# Tibbles!
----
`r icons::icon_style(icons::fontawesome("r-project"), scale = 3, fill = "white")`




---

.center[
# Tibbles
]


.panelset[

.panel[.panel-name[Overview]

.pull-left[
- Tibbles are the tidyverse version of a data frame <br> <br>
- Mostly the same as data.frames but changes some behavior <br> <br>
- Part of the `tibble` package, which is bundled as part of the `tidyverse`
]

.pull-right[
```{r echo = FALSE}
head(penguins)
```

]

]<!---->

.panel[.panel-name[Creating Tibbles]

.pull-left[
- Tibbles are created much like data.frames <br> <br>
- Use the `tibble()` function to create a tibble <br> <br>
- Supply data as arguments
- can convert a data.frame to a tibble using the `as_tibble()` function
]

.pull-right[
```{r}
tibble(
  'var 1' = c(1, 2, 3, 4),
  '2 var' = c(5, 6, 7, 8)
)
```

]

]<!---->

]<!--end panelset-->


---

.center[
# Tibbles vs. data.frames
]


.pull-left[

.center[
### data.frame
]

- May convert variable types
   - Used to default to converting string variables to factors before R 4.0.0
- Will change variable names if non-syntactic characters are used (e.g., spaces will be replaced by ".")
- Default print:  All columns, max number of rows
]

.pull-right[

.center[
### tibble
]

- Never converts variable type
- Can use non-syntactic variable names (use backticks)
- Default print: First 10 rows and all columns that fit on screen
   - use `print()` to display more rows or columns
      - n argument controls rows, width argument controls columns

]


---

.center[
# Tribble!
]

.pull-left[
- The `tribble()` function provides a more user-friendly way of creating tibbles for data entry <br> <br>
- `tribble()` stands for transposed tibble
- creates tibbles in a row-wise fashion
]


.pull-right[
```{r}
tribble(
  ~var1, ~var2,
  1, 5,
  2, 6,
)
```

]


---
class: inverse center middle

# Subsetting
----
`r icons::icon_style(icons::fontawesome("r-project"), scale = 3, fill = "white")`



---

.center[
# Subsetting
]

.pull-left[
- There are three ways to pull out a single variable from a data.frame or tibble
   1. `df$var`
   1. `df[["var"]]`
   1. `df %>% pull("var")`
- 1 and 2 are base R conventions, 3 is from `dplyr`
- Note that we can use the column name or the column position to subset with `[[ ]]` and `pull()`
]

.pull-right[
```{r eval = FALSE, message = FALSE, warning = FALSE}
penguins$species
```

```{r eval = FALSE, message = FALSE, warning = FALSE}
penguins[["species"]]
```

```{r eval = FALSE, message = FALSE, warning = FALSE}
penguins[[1]]
```

```{r eval = FALSE, message = FALSE, warning = FALSE}
penguins %>% 
  pull("species")
```


```{r eval = FALSE, message = FALSE, warning = FALSE}
penguins %>% 
  pull(1)
```

]



---

.center[
# Subsetting in a Pipe
]

.pull-left[
- To subset within a pipe, use the "." placeholder <br> <br>
- "." means "everything up until this point" <br> <br>
- Does not apply to `pull`
]

.pull-right[
```{r eval = FALSE}
penguins %>% 
  .$species
```

```{r eval = FALSE}
penguins %>% 
  .$[["species"]]
```

```{r eval = FALSE}
penguins %>% 
  pull(1)
```

]


---

.center[
# Indexing in Base R
]

.panelset[

.panel[.panel-name[Overview]

.pull-left[
- To select a value from a data frame, write the data frame's name followed by a pair of hard brackets

```{r eval = FALSE}
penguins[ , ]
```

- between the brackets will go two indexes separated by a comma
- R will use the first index to subset the rows of the data frame and the second index to subset the columns
]

.pull-right[
- Six ways to write an index in R
   1. Positive Integers
   1. Negative Integers
   1. Zero
   1. Blank Spaces
   1. Logical Values
   1. Names
]
]

.panel[.panel-name[Positive Integers]

.pull-left[
- R treats positive integers like *ij* notation in linear algebra
- `penguins[i,j]` will return the value of `penguins` in the *ith* row and the *jth* column

```{r}
penguins[1, 1]
```
]

.pull-right[
- To obtain more than one value, use a vector of positive integers

<br>

```{r}
penguins[1, c(1, 2, 3)]
```
]
]


.panel[.panel-name[Negative Integers]

- Negative integers do the exact opposite of positive integers when indexing.
- R will return every element except the elements in a negative index
- The below code will remove the first row from the dataset and retain the first three columns
```{r eval = FALSE}
penguins[-1, c(1, 2, 3)]
```


]


.panel[.panel-name[Zero]

- R will return nothing from a dimension when you use zero as an index.
- This will create an empty object
- Zero is not very useful

```{r}
penguins[0, c(1, 2, 3)]
```


]


.panel[.panel-name[Blank Spaces]

- You can use a blank space to tell R to extract *every* value in a dimensions
- This lets you subset an object on one dimension but not the others
- Useful for extracting entire rows or columns from a data frame

```{r}
penguins[1, ]
```

]


.panel[.panel-name[Logical Values]

- If you supply a vector of TRUEs and FALSEs as your index, R will match each TRUE and FALSE to a row/column in your data frame
- R will return all rows/columns associated with TRUE
- Not commonly used

```{r}
penguins[1, c(TRUE, TRUE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE)]
```


]


.panel[.panel-name[Names]

- Instead of using positions via numbers, you can ask for elements you want by name
- Useful for extracting columns from a data frame

```{r}
penguins[1, c("species", "island", "bill_length_mm")]
```

]



]